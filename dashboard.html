<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Georgia County Home‑Value Trends &amp; Map</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body { font-family: sans-serif; margin:2rem; }
    h1 { margin-bottom:.2rem; }
    #container {
      display: flex;
      gap: 1rem;
    }
    svg { background: #fafafa; border:1px solid #ccc; }
    .line { fill: none; stroke-width: 2px; opacity: .7; cursor: pointer; }
    .line:hover,
    .line.active { opacity: 1; stroke-width: 3px; }
    .county { stroke: #333; stroke-width:.5; }
    .county:hover,
    .county.active { stroke: #000; stroke-width:1.5; }
    .legend { font-size:.8rem; }
  </style>
</head>
<body>
  <h1>Georgia County Home‑Value Trends &amp; Map</h1>
  <p>Hover or click on any county to see details across both charts.</p>

  <div id="container">
    <svg id="timeseries" width="600" height="400"></svg>
    <svg id="map"        width="600" height="400"></svg>
  </div>

  <script>
  // 1) Data URLs (raw GitHub)
  const csvUrl = "https://raw.githubusercontent.com/jason200/ga-housing-narrative-viz/main/data/home_values.csv";
  const geoUrl = "https://raw.githubusercontent.com/jason200/ga-housing-narrative-viz/main/data/counties.geojson";

  Promise.all([
    d3.csv(csvUrl, d3.autoType),
    d3.json(geoUrl)
  ]).then(([data, geo]) => {
    // nest by county
    const counties = d3.group(data, d => d.County);
    const years = Array.from(new Set(data.map(d => d.Year))).sort();

    // Time series SVG
    const tsSvg = d3.select("#timeseries");
    const margin = {top:20, right:30, bottom:40, left:50};
    const w = +tsSvg.attr("width")  - margin.left - margin.right;
    const h = +tsSvg.attr("height") - margin.top  - margin.bottom;
    const gTS = tsSvg.append("g").attr("transform","translate("+margin.left+","+margin.top+")");

    // x/y scales
    const x = d3.scaleLinear().domain(d3.extent(years)).range([0,w]);
    const y = d3.scaleLinear()
                .domain([0, d3.max(data, d => d.Value)])
                .nice().range([h,0]);

    // axes
    gTS.append("g").attr("transform","translate(0,"+h+")")
        .call(d3.axisBottom(x).ticks(6).tickFormat(d3.format("d")));
    gTS.append("g").call(d3.axisLeft(y));

    // line generator
    const line = d3.line()
      .x(d => x(d.Year))
      .y(d => y(d.Value));

    // draw one path per county
    const path = gTS.selectAll(".line")
      .data(counties)
      .join("path")
        .attr("class","line")
        .attr("id", ([k]) => "line_"+k.replace(/\s+/g,"_"))
        .attr("d", ([k,values]) => line(values.sort((a,b)=>a.Year-b.Year)))
        .attr("stroke", (d,i) => d3.schemeTableau10[i%10]);

    // choropleth
    const mapSvg = d3.select("#map"),
          mg = mapSvg.append("g").attr("transform","translate(0,20)"),
          projection = d3.geoAlbersUsa()
                         .fitSize([+mapSvg.attr("width"), +mapSvg.attr("height")-20], geo),
          pathGen = d3.geoPath(projection),
          latest = d3.rollup(data, v=>v.find(d=>d.Year===2025).Value, d=>d.County);

    const color = d3.scaleSequential()
      .domain(d3.extent(Array.from(latest.values())))
      .interpolator(d3.interpolateBlues);

    mg.selectAll("path")
      .data(geo.features)
      .join("path")
        .attr("class","county")
        .attr("id", d=>"county_"+d.properties.NAME.replace(/\s+/g,"_"))
        .attr("d", pathGen)
        .attr("fill", d => color(latest.get(d.properties.NAME)));

    // interaction: hover / click
    function activate(county){
      // clear
      path.classed("active",false);
      mg.selectAll(".county").classed("active",false);
      if(county){
        d3.select("#line_"+county).classed("active",true);
        d3.select("#county_"+county).classed("active",true);
      }
    }

    path.on("mouseover", ([county]) => activate(county.replace(/\s+/g,"_")))
        .on("mouseout", () => activate(null))
        .on("click", ([county]) => activate(county.replace(/\s+/g,"_")));

    mg.selectAll(".county")
      .on("mouseover", d => activate(d.properties.NAME.replace(/\s+/g,"_")))
      .on("mouseout", () => activate(null))
      .on("click", d => activate(d.properties.NAME.replace(/\s+/g,"_")));
  })
  .catch(err => console.error(err));
  </script>
</body>
</html>
