<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

<div id="lineChart"></div>
<div id="barChart"></div>

<script>
  // 1) Point at your CSV on GitHub Pages
  const CSV_URL = 'https://jason200.github.io/ga-housing-narrative-viz/data/home_values.csv';

  // 2) Load with D3
  d3.csv(CSV_URL).then(raw => {
    // 3) Find Georgiaâ€™s row
    const geo = raw.find(r => r.RegionName === 'Georgia');

    // 4) Shape into an array of {date,value}
    const all = Object.entries(geo)
      .filter(([k]) => /^\d{4}-\d{2}-\d{2}$/.test(k))
      .map(([d,v]) => ({ date: d, value: +v }));

    // 5) Vega-Lite spec for the full monthly line chart
    const lineSpec = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "width": 500,
      "height": 350,
      "data": { "values": all },
      "mark": { "type": "line", "color": "#4682b4" },
      "encoding": {
        "x": { "field": "date", "type": "temporal", "title": "Year", "axis": {"format":"%Y"} },
        "y": { "field": "value", "type": "quantitative", "title": "Median Value ($)" }
      }
    };

    // 6) Vega-Lite spec for the 2025 bar snapshot
    const snap2025 = all.filter(d => d.date.startsWith('2025-'));
    const barSpec = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "width": 300,
      "height": 350,
      "data": { "values": snap2025 },
      "mark": "bar",
      "encoding": {
        "x": {
          "field": "date", "type": "ordinal", "title": "Month of 2025",
          "axis": {"labelAngle":-45}
        },
        "y": { "field": "value", "type": "quantitative", "title": "Median Value ($)" }
      }
    };

    // 7) Embed them
    vegaEmbed('#lineChart', lineSpec, {actions:false});
    vegaEmbed('#barChart',  barSpec,  {actions:false});
  })
  .catch(err => console.error('CSV load error:', err));
</script>
